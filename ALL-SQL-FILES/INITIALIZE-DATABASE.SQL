SET SERVEROUTPUT ON;

--create user frontdesk identified by Khushbu@1234;
--create user housekeeping identified by Monish@12345;
--create user manager identified by Jatin@123456;
--create user main_admin identified by Puja@1234567;

--dbms_output.put_line(' ---------------------------------------------------- STARTING WITH SQL QUERIES ----------------------------------------------------');
select localtimestamp from dual;
---------------------------------------------------- LOCATION TABLE  -------------------------------------------
    -- TABLE CREATION PROCEDURE
    create or replace procedure location_creation is
    table_name varchar2(4000);
   
    BEGIN
    -- table creation query
       table_name:='CREATE TABLE LOCATION(
                            LOCATION_ID  NUMBER GENERATED BY DEFAULT AS IDENTITY,
                            STATE VARCHAR(8) NOT NULL,
                            CITY VARCHAR(50),
                            ZIPCODE VARCHAR(5) NOT NULL UNIQUE,
                            constraint pk_loc_id PRIMARY KEY(LOCATION_ID)
                    )';
       EXECUTE IMMEDIATE table_name;
    end location_creation;
    /
    
      DECLARE
            table_name varchar2(50);
            nCount NUMBER;
        BEGIN
            table_name:='LOCATION';
            SELECT count(*) into nCount FROM user_tables where table_name = 'LOCATION';
            IF(nCount > 0)
            
            THEN
                    DBMS_OUTPUT.PUT_LINE('TABLE '|| table_name ||' ALREADY EXISTS.');
            ELSE
            -- call to table creation stored procedure 
                begin 
                 location_creation;
                end;    
            DBMS_OUTPUT.PUT_LINE('TABLE ' ||table_name ||' CREATED');
            
            END IF;
            exception 
              when no_data_found then
               dbms_output.put_line('table doesnt exits!, So we created one');
               
               -- call to table creation stored procedure 
               begin 
                 location_creation;
                end; 
                
                when others
                    then
                    dbms_output.put_line('Something went wrong!');
                    dbms_output.put_line(dbms_utility.format_error_stack);
    END;
    /  
    ---------------------------------------------------- PACKAGES ----------------------------------------------------

create or replace package insertion
    as
        procedure insrt_location(state_name in varchar, city_name in varchar, zipcode in varchar);
    end;
/

create or replace package body insertion
    as
    procedure insrt_location(state_name in varchar, city_name in varchar, zipcode in varchar)
         as      
        begin
                 dbms_output.put_line('----------------------------------------------------------');
                insert into  LOCATION(state, city, zipcode) values (state_name, city_name, zipcode);
             dbms_output.put_line('Row inserted at Location table');
                 dbms_output.put_line('----------------------------------------------------------');
            commit;
            exception
                WHEN DUP_VAL_ON_INDEX
                then
                dbms_output.put_line('Oop! This record already exists');
                rollback;
                when others then
                    dbms_output.put_line('Error while inserting data in Location Table');
                    rollback;
                    dbms_output.put_line('The error encountered is: ');
                    dbms_output.put_line(dbms_utility.format_error_stack);
                    dbms_output.put_line('----------------------------------------------------------');
            end insrt_location; 
    end;
/

    execute insertion.insrt_location('MA','Boston','02115');
    execute insertion.insrt_location('TX','DALLAS','04567');
    execute insertion.insrt_location('CA','SAN JOSE','08921');
    execute insertion.insrt_location('NY','NY CITY','01209');
    execute insertion.insrt_location('NY','BROOKLYN','01209');
    execute insertion.insrt_location('NY','BUFFALO','01209');
    execute insertion.insrt_location('CA','SANTA CLARA','08921');

    --select * from LOCATION;

    ---------------------------------------------------- HOTEL TABLE  -------------------------------------------

    -- TABLEC REATION PROCEDURE
    create or replace procedure hotel_creation is
    table_name varchar2(4000);
   
    BEGIN
    -- table creation query
       table_name:='CREATE TABLE HOTEL(
                            HOTEL_ID  NUMBER GENERATED BY DEFAULT AS IDENTITY,
                            HOTEL_NAME VARCHAR2(255) NOT NULL UNIQUE,
                            LOCATION_ID NUMBER,
                            RATING VARCHAR2(50),
                            constraint pk_htl_id PRIMARY KEY(HOTEL_ID),
                            constraint fk_loc_id FOREIGN KEY(LOCATION_ID) REFERENCES location (location_id)
                           
                    )';
       EXECUTE IMMEDIATE table_name;
    end hotel_creation;
    /
    
      DECLARE
            table_name varchar2(50);
            nCount NUMBER;
        BEGIN
            table_name:='HOTEL';
            SELECT count(*) into nCount FROM user_tables where table_name = 'HOTEL';
            IF(nCount > 0)
            
            THEN
                    DBMS_OUTPUT.PUT_LINE('TABLE '|| table_name ||' ALREADY EXISTS.');
            ELSE
            -- call to table creation stored procedure 
                begin 
                 hotel_creation;
                end;    
            DBMS_OUTPUT.PUT_LINE('TABLE' ||table_name ||' CREATED');
            
            END IF;
            exception 
              when no_data_found then
               dbms_output.put_line('table doesnt exits!, So we created one');
               
               -- call to table creation stored procedure 
               begin 
                 hotel_creation;
                end; 
                
                when others
                    then
                    dbms_output.put_line('Something went wrong!');
                    dbms_output.put_line(dbms_utility.format_error_stack);
    END;
    /  
    
     create or replace procedure insrt_hotel(hotel_name in varchar, location_id_name in number, rating in varchar)
         as
          begin
                 dbms_output.put_line('----------------------------------------------------------');
                insert into  HOTEL(HOTEL_NAME, LOCATION_ID, RATING) values (hotel_name, location_id_name, rating);
             dbms_output.put_line('Row inserted at HOTEL table');
                 dbms_output.put_line('----------------------------------------------------------');
            commit;
            exception
                WHEN DUP_VAL_ON_INDEX
                then
                dbms_output.put_line('Oop! This record already exists');
                rollback;
                when others then
                    dbms_output.put_line('Error while inserting data in HOTEL Table');
                    rollback;
                    dbms_output.put_line('The error encountered is: ');
                    dbms_output.put_line(dbms_utility.format_error_stack);
                    dbms_output.put_line('----------------------------------------------------------');
            end insrt_hotel;
     /
    
    execute insrt_hotel('Hyatt Regency',1,'3 Star');
    execute insrt_hotel('Hyatt Grand',2,'4 Star');
    execute insrt_hotel('Andaz West Hollywood',3,'3 Star');
    execute insrt_hotel('Grand Hyatt DFW',4,'3 Star');

    --select * from hotel;

    ---------------------------------------------------- DISCOUNT TABLE  -------------------------------------------

 -- TABLE CREATION PROCEDURE
    create or replace procedure discount_creation is
    table_name varchar2(4000);
   
    BEGIN
    -- table creation query
       table_name:='CREATE TABLE DISCOUNT(
                            disc_id  NUMBER GENERATED BY DEFAULT AS IDENTITY,
                            disc_value NUMBER NOT NULL UNIQUE,
                            constraint pk_discount_id PRIMARY KEY(disc_id)
                    )';
       EXECUTE IMMEDIATE table_name;
    end discount_creation;
    /
    
      DECLARE
            table_name varchar2(50);
            nCount NUMBER;
        BEGIN
            table_name:='DISCOUNT';
            SELECT count(*) into nCount FROM user_tables where table_name = 'DISCOUNT';
            IF(nCount > 0)
            
            THEN
                    DBMS_OUTPUT.PUT_LINE('TABLE '|| table_name||' ALREADY EXISTS.');
            ELSE
            -- call to table creation stored procedure 
                begin 
                 discount_creation;
                end;    
             DBMS_OUTPUT.PUT_LINE('TABLE '||table_name||' CREATED.');
            
            END IF;
            exception 
              when no_data_found then
               dbms_output.put_line('table doesnt exits!, So we created one');
               
               -- call to table creation stored procedure 
               begin 
                 discount_creation;
                end; 
                
                when others
                    then
                    dbms_output.put_line('Something went wrong!');
                    dbms_output.put_line(dbms_utility.format_error_stack);
    END;
    /  
    
     create or replace procedure insrt_discount(disc_value_name in number)
         as
          begin
                 dbms_output.put_line('----------------------------------------------------------');
                insert into DISCOUNT(disc_value) values (disc_value_name);
             dbms_output.put_line('Row inserted at Discount table');
                 dbms_output.put_line('----------------------------------------------------------');
            commit;
            exception
                WHEN DUP_VAL_ON_INDEX
                then
                dbms_output.put_line('Oop! This record already exists');
                rollback;
                when others then
                    dbms_output.put_line('Error while inserting data in Discount Table');
                    rollback;
                    dbms_output.put_line('The error encountered is: ');
                    dbms_output.put_line(dbms_utility.format_error_stack);
                    dbms_output.put_line('----------------------------------------------------------');
            end insrt_discount;
     /
    
    execute insrt_discount(10);
    execute insrt_discount(15);
    execute insrt_discount(20);
    execute insrt_discount(30);
    execute insrt_discount(40);
    execute insrt_discount(50);
    
    --select * from discount;

---------------------------------------------------- MEMBER TABLE  -------------------------------------------
     -- TABLE CREATION PROCEDURE
    create or replace procedure member_table_creation is
    table_name varchar2(4000);
   
    BEGIN
    -- table creation query
       table_name:='create table MEMBER(  
                      mem_id NUMBER GENERATED BY DEFAULT AS IDENTITY,  
                      mem_type varchar2(16) NOT NULL unique,
                      mem_renew_date date DEFAULT (sysdate) NOT NULL,
                      disc_id number NOT NULL,
                      constraint pk_mem_id primary key(mem_id),
                      constraint fk_member_id FOREIGN KEY (disc_id) REFERENCES discount (disc_id)
                    )';
       EXECUTE IMMEDIATE table_name;
    end member_table_creation;
    /
    
  DECLARE
        tname varchar2(50);
        nCount NUMBER;
    BEGIN
        tname := 'MEMBER';
        SELECT count(*) into nCount FROM user_tables where table_name = tname;
        IF(nCount > 0)
        
        THEN
               DBMS_OUTPUT.PUT_LINE('TABLE '|| tname ||' ALREADY EXISTS.');
        ELSE
        -- call to table creation stored procedure 
            begin 
             member_table_creation;
            end;    
         DBMS_OUTPUT.PUT_LINE('TABLE '|| tname ||' CREATED.');
        
        END IF;
        exception 
          when no_data_found then
           dbms_output.put_line('table doesnt exits!, So we created one');
           
           -- call to table creation stored procedure 
           begin 
             member_table_creation;
            end; 
            
            when others
                then
                DBMS_OUTPUT.PUT_LINE(nCount);
                dbms_output.put_line('Something went wrong!');
                dbms_output.put_line(dbms_utility.format_error_stack);
END;
/  

   create or replace procedure insrt_member(mem_type in varchar, mem_renew_date in date, disc_id in number)
         as
          begin
                 dbms_output.put_line('----------------------------------------------------------');
                insert into MEMBER(mem_type, mem_renew_date, disc_id) values (mem_type, mem_renew_date, disc_id);
             dbms_output.put_line('Row inserted at Member table');
                 dbms_output.put_line('----------------------------------------------------------');
            commit;
            exception
            WHEN DUP_VAL_ON_INDEX
                then
                dbms_output.put_line('Oop! This record already exists');
                rollback;
                when others then
                    dbms_output.put_line('Error while inserting data in Member Table');
                    rollback;
                    dbms_output.put_line('The error encountered is: ');
                    dbms_output.put_line(dbms_utility.format_error_stack);
                    dbms_output.put_line('----------------------------------------------------------');
            end insrt_member;
     /
    
    execute insrt_member('PLATINUM',TO_DATE('2022/05/11 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),5);
    execute insrt_member('SUPER PLATINUM',TO_DATE('2022/05/03 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),4);
    execute insrt_member('GOLD',TO_DATE('2022/05/17 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    execute insrt_member('SILVER',TO_DATE('2022/05/22 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
    
    --select * from member;

---------------------------------------------------- PREFERENCES TABLE  -------------------------------------------

 -- TABLE CREATION PROCEDURE
    create or replace procedure preferences_creation is
        table_name varchar2(4000);
   
    BEGIN
    -- table creation query
       table_name:='create table PREFERENCES(  
                        prf_id NUMBER GENERATED BY DEFAULT AS IDENTITY,  
                        preferences varchar2(255) NOT NULL,
                        constraint pk_prf_id primary key (prf_id)  
                    )';
    EXECUTE IMMEDIATE table_name;
    end preferences_creation;
    /
    
 -- Drop table preferences;  
    
  DECLARE
        tname varchar2(50);
        nCount NUMBER;
    BEGIN
        tname := 'PREFERENCES';
        SELECT count(*) into nCount FROM user_tables where table_name = tname;
        IF(nCount > 0)
        
        THEN
                DBMS_OUTPUT.PUT_LINE('TABLE '||tname ||' ALREADY EXISTS.');
          
        ELSE
        
        -- call to table creation stored procedure 
            begin 
             preferences_creation;
                      DBMS_OUTPUT.PUT_LINE('TABLE '|| tname ||' CREATED.');
            end;    
   
        END IF;
        exception 
          when no_data_found then
           dbms_output.put_line('table doesnt exits!, So we created one');
           
           -- call to table creation stored procedure 
           begin 
             preferences_creation;
            end; 
            
            when others
                then
                dbms_output.put_line('Something went wrong!');
                dbms_output.put_line(dbms_utility.format_error_stack);
END;
/  

create or replace procedure insrt_preferences(preferences_name in varchar)
         as
          begin
                 dbms_output.put_line('----------------------------------------------------------');
                insert into PREFERENCES(preferences) values (preferences_name);
             dbms_output.put_line('Row inserted at PREFERENCES table');
                 dbms_output.put_line('----------------------------------------------------------');
            commit;
            
            exception
                when others then
                    dbms_output.put_line('Error while inserting data in PREFERENCES Table');
                    rollback;
                    dbms_output.put_line('The error encountered is: ');
                    dbms_output.put_line(dbms_utility.format_error_stack);
                    dbms_output.put_line('----------------------------------------------------------');
            end insrt_preferences;
     /
    
    execute insrt_preferences('Guest loves to smoke');
    execute insrt_preferences('Guests Need newspaper every Morning');
    execute insrt_preferences('Guest is allergic to pets');
    execute insrt_preferences('Guest wants rooms with windows facing the pool');
    
    --select * from PREFERENCES;

---------------------------------------------------- GUEST TABLE  -------------------------------------------

-- TABLE CREATION PROCEDURE
    create or replace procedure guest_creation is table_name varchar2(4000);
   
    BEGIN
    -- table creation query
       table_name:='create table GUEST(  
                        guest_id  NUMBER GENERATED BY DEFAULT AS IDENTITY,  
                        guest_name varchar2(50) NOT NULL,
                        DOB date NOT NULL,
                        ph_num varchar2(16) NOT NULL,
                        email varchar2(255),
                        mem_id number,
                        vip_status varchar(8),
                        gender varchar(8) NOT NULL,
                        prf_id  number,
                        primary key (guest_id),
                        constraint unique_PHONE UNIQUE (PH_NUM),
                        constraint fk_prf_id FOREIGN KEY (prf_id) REFERENCES PREFERENCES(prf_id),
                        CONSTRAINT fk_guest_membership FOREIGN KEY (mem_id) REFERENCES MEMBER(mem_id) ON DELETE SET NULL, 
                        CHECK(REGEXP_LIKE(email,''^[A-Za-z]+[A-Za-z0-9.]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$'')),
                        CHECK(REGEXP_LIKE(ph_num,''^[0-9]{10}$''))
                    )';
       EXECUTE IMMEDIATE table_name;
    end guest_creation;
    /
    
      DECLARE
            tname varchar2(50);
            nCount NUMBER;
        BEGIN
            tname:='GUEST';
             SELECT count(*) into nCount FROM user_tables where table_name = tname;
            IF(nCount > 0)
            
            THEN
                    DBMS_OUTPUT.PUT_LINE('TABLE '|| tname || ' ALREADY EXISTS.');
            ELSE
            -- call to table creation stored procedure 
                begin 
                 guest_creation;
                end;    
            DBMS_OUTPUT.PUT_LINE('TABLE ' || tname ||' CREATED.');
            
            END IF;
            exception 
              when no_data_found then
               dbms_output.put_line('Table '||tname ||' doesnt exits! So we created one');
               
               -- call to table creation stored procedure 
               begin 
                 guest_creation;
                end; 
                
                when others
                    then
                    dbms_output.put_line('Something went wrong!');
                    dbms_output.put_line(dbms_utility.format_error_stack);
    END;
    /  
    
    create or replace procedure insrt_guest(GUEST_NAME in varchar,DOB IN DATE, PH_NUM IN VARCHAR, EMAIL IN VARCHAR2,MEM_ID IN NUMBER, VIP_STATUS IN VARCHAR,GENDER IN VARCHAR, PRF_ID IN VARCHAR)
         as
          begin
          
                 dbms_output.put_line('----------------------------------------------------------');
                insert into GUEST(GUEST_NAME , DOB , PH_NUM, EMAIL,MEM_ID, VIP_STATUS,GENDER, PRF_ID) values (GUEST_NAME  ,DOB  , PH_NUM  , EMAIL,MEM_ID, VIP_STATUS,GENDER, PRF_ID);
             dbms_output.put_line('Row inserted at GUEST table');
                 dbms_output.put_line('----------------------------------------------------------');
            commit;
            exception
            WHEN DUP_VAL_ON_INDEX
                then
                dbms_output.put_line('Oops! This record already exists');
                rollback;
                when others then
                    dbms_output.put_line('Error while inserting data in GUEST Table');
                    rollback;
                    dbms_output.put_line('The error encountered is: ');
                    dbms_output.put_line(dbms_utility.format_error_stack);
                    dbms_output.put_line('----------------------------------------------------------');
            end insrt_guest;
     /
    
    execute insrt_guest('PUJA','24 MAY 1996','9851024784','PUZA@GMAIL.COM',4,'VIP-3','FEMALE',1);
    execute insrt_guest('NARENDRA MODI',TO_DATE('1950/08/17', 'yyyy/mm/dd'),'6177927768','NARENDRA.MODI@GMAIL.COM',2,'VIP-1','MALE',2);
    execute insrt_guest('AMIR KHAN',TO_DATE('1965/03/14', 'yyyy/mm/dd'),'8899223344','AMIR@GMAIL.COM',1,'VIP-2','MALE',4);
    execute insrt_guest('MONISH M.',TO_DATE('1995/06/14', 'yyyy/mm/dd'),'1122334455','MONISH@GMAIL.COM',NULL,2,'MALE',NULL);
    execute insrt_guest('JATIN BALI',TO_DATE('1998/05/17', 'yyyy/mm/dd'),'4455667788','JATIN@GMAIL.COM',NULL,NULL,'MALE',3);
    execute insrt_guest('KHUSHBU T',TO_DATE('1994/01/14', 'yyyy/mm/dd'),'5533116688','KHUSHBU@GMAIL.COM',NULL,NULL,'FEMALE',NULL);

    --select * from GUEST;
    
    ---------------------------------------------------- AMENITY TABLE  -------------------------------------------

     -- TABLE CREATION PROCEDURE
    create or replace procedure amenity_creation is table_name varchar2(4000);
   
    BEGIN
    -- table creation query
       table_name:='CREATE TABLE AMENITY(
                        AMENITY_ID NUMBER GENERATED BY DEFAULT AS IDENTITY ,
                        AMENITY_NAME VARCHAR(255) NOT NULL,
                        AMENITY_PRICE FLOAT(5) NOT NULL,
                        IS_PRSN_SPC CHAR(1) NOT NULL,
                        constraint fk_amenity_id primary key(AMENITY_ID)
                    )';
       EXECUTE IMMEDIATE table_name;
    end amenity_creation;
    /
    
      DECLARE
            tname varchar2(50);
            nCount NUMBER;
        BEGIN
            SELECT count(*) into nCount FROM user_tables where table_name = 'AMENITY';
            IF(nCount > 0)
            
            THEN
                    DBMS_OUTPUT.PUT_LINE('TABLE AMENITY ALREADY EXISTS.');
            ELSE
            -- call to table creation stored procedure 
                begin 
                 amenity_creation;
                end;    
            DBMS_OUTPUT.PUT_LINE('TABLE AMENITY CREATED.');
            
            END IF;
            exception 
              when no_data_found then
               dbms_output.put_line('table doesnt exits!, So we created one');
               
               -- call to table creation stored procedure 
               begin 
                 amenity_creation;
                end; 
                
                when others
                    then
                    dbms_output.put_line('Something went wrong!');
                    dbms_output.put_line(dbms_utility.format_error_stack);
    END;
    /  
    
     create or replace procedure insrt_amenity(amenity_name in varchar, price in varchar, prsn_spc in varchar)
         as
          begin
                 dbms_output.put_line('----------------------------------------------------------');
                insert into AMENITY(amenity_name, amenity_price, IS_PRSN_SPC) values (amenity_name, price, prsn_spc);
             dbms_output.put_line('Row inserted at Amenity table');
                 dbms_output.put_line('----------------------------------------------------------');
            commit;
            exception
            WHEN DUP_VAL_ON_INDEX
            then
            dbms_output.put_line('Oops! This record already exist in Amenity Table');
            rollback;
          --  dbms_output.put_line('The error encountered is: ');
          -- dbms_output.put_line(dbms_utility.format_error_stack);
            rollback;
                when others then
                    dbms_output.put_line('Error while inserting data in Amenity Table');
                    rollback;
                    dbms_output.put_line('The error encountered is: ');
                    dbms_output.put_line(dbms_utility.format_error_stack);
                    dbms_output.put_line('----------------------------------------------------------');

            end insrt_amenity;
     /
    
    execute insrt_amenity('Swimming Pool',0,'n');
    execute insrt_amenity('Recreational Gym',1500,'y');
    execute insrt_amenity('Recreational Spa',2000,'y');
    execute insrt_amenity('Conference Room',2000,'y');
    execute insrt_amenity('Culb Access',1500,'y');
    execute insrt_amenity('Audio Visiual Room',2000,'y');
    execute insrt_amenity('Front View',0,'n');
    execute insrt_amenity('Top View',0,'n');
    execute insrt_amenity('Smooking Room',1000,'n');
    execute insrt_amenity('Top-View',0,'n');
    execute insrt_amenity('TV',1500,'y');
    
    --select * from AMENITY;

    ---------------------------------------------------- DEPARTMENT TABLE  -------------------------------------------

    -- TABLE CREATION PROCEDURE
    create or replace procedure dept_creation is
    table_name varchar2(4000);
    
    BEGIN
    -- table creation query
       table_name:='CREATE TABLE DEPARTMENT(
                      DEPT_ID NUMBER GENERATED BY DEFAULT AS IDENTITY ,  
                      DEPT_NAME varchar2(50) NOT NULL UNIQUE,
                      constraint PK_DEPT_ID primary key (DEPT_ID) 
                    )';
                        
    EXECUTE IMMEDIATE table_name;
    end dept_creation;
    /
    
      DECLARE
            tName varchar2(50);
            nCount NUMBER;
        BEGIN
            tName:= 'DEPARTMENT';
            SELECT count(*) into nCount FROM user_tables where table_name = tName;
            IF(nCount > 0)
            
            THEN
                    DBMS_OUTPUT.PUT_LINE('TABLE '||tName ||' ALREADY EXISTS.');
            ELSE
            -- call to table creation stored procedure 
                begin 
                 Dept_creation;
                end;    
            DBMS_OUTPUT.PUT_LINE('TABLE '|| tName ||' CREATED.');
            
            END IF;
            exception 
              when no_data_found then
               dbms_output.put_line('table doesnt exits!, So we created one');
               
               -- call to table creation stored procedure 
               begin 
                 Dept_creation;
                end; 
                
                when others
                    then
                    dbms_output.put_line('Something went wrong!');
                    dbms_output.put_line(dbms_utility.format_error_stack);
    END;
    /  
    
     create or replace procedure insrt_department (DEPT_NAME_name in varchar)
         as 
          begin
                 dbms_output.put_line('----------------------------------------------------------');
                insert into DEPARTMENT(DEPT_NAME) values (DEPT_NAME_name);
             dbms_output.put_line('Row inserted at DEPARTMENT table');
                 dbms_output.put_line('----------------------------------------------------------');
            commit;
            exception
            
             WHEN DUP_VAL_ON_INDEX
                then
                dbms_output.put_line('Oop! This record already exists in department table.');
                rollback;
                when others then
                    dbms_output.put_line('Error while inserting data in DEPARTMENT Table');
                    rollback;
                    dbms_output.put_line('The error encountered is: ');
                    dbms_output.put_line(dbms_utility.format_error_stack);
                    dbms_output.put_line('----------------------------------------------------------');
            end insrt_department;
     /
    
    execute insrt_department('Front Desk');
    execute insrt_department('HouseKeeping');
    execute insrt_department('Food and Beverage Service');
    execute insrt_department('Engineering and Maintenance');
    execute insrt_department('Security Department');
    execute insrt_department('Human Resources (HR)');
    
    --select * from DEPARTMENT;

    ---------------------------------------------------- DESIGNATION TABLE  -------------------------------------------

    -- TABLEC REATION PROCEDURE
    create or replace procedure designation_creation is
    table_name varchar2(4000);
   
    BEGIN
    -- table creation query
       table_name:= 'CREATE TABLE DESIGNATION (
                        DESG_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
                        DESG_NAME VARCHAR(50) NOT NULL unique,
                        constraint PK_DESG_ID  primary key(DESG_ID)
                        )';

    EXECUTE IMMEDIATE table_name;
    end designation_creation;
    /
    
      DECLARE
            
            table_name varchar2(50);
            nCount NUMBER;
        BEGIN
            table_name:= 'DESIGNATION';
            SELECT count(*) into nCount FROM user_tables where table_name = 'DESIGNATION';
            IF(nCount > 0)
            
            THEN
                    DBMS_OUTPUT.PUT_LINE('TABLE '||table_name ||' ALREADY EXISTS.');
            ELSE
            -- call to table creation stored procedure 
                begin 
                 designation_creation;
                end;    
            DBMS_OUTPUT.PUT_LINE('TABLE '||TABLE_NAME||' CREATED.');
            
            END IF;
            exception 
            
              when no_data_found then
               dbms_output.put_line('table doesnt exits!, So we created one');
               
               -- call to table creation stored procedure 
               begin 
                 designation_creation;
                end; 
                
                when others
                    then
                    dbms_output.put_line('Something went wrong!');
                    dbms_output.put_line(dbms_utility.format_error_stack);
    END;
    /  
    
     create or replace procedure insrt_designation(DESG_NAME_name in varchar)
         as
          begin
                 dbms_output.put_line('----------------------------------------------------------');
                insert into  DESIGNATION(DESG_NAME) values (DESG_NAME_name);
             dbms_output.put_line('Row inserted at DESIGNATION table');
                 dbms_output.put_line('----------------------------------------------------------');
            commit;
            exception
             WHEN DUP_VAL_ON_INDEX
                then
                dbms_output.put_line('Oop! This record already exists');
                rollback;
                when others then
                    dbms_output.put_line('Error while inserting data in DESIGNATION Table');
                    rollback;
                    dbms_output.put_line('The error encountered is: ');
                    dbms_output.put_line(dbms_utility.format_error_stack);
                    dbms_output.put_line('----------------------------------------------------------');
            end insrt_designation;
     /
    
    execute insrt_designation('Duty Manager');
    execute insrt_designation('Team Leader');
    execute insrt_designation('Front Desk Officer');
    execute insrt_designation('Guest Service Officer');
    execute insrt_designation('Senior Guest Service Officer');
    execute insrt_designation('Assistent Front office manager');
    execute insrt_designation('Front Office manager');
    execute insrt_designation('Director of Room');
    execute insrt_designation('Floor Attendant');
    execute insrt_designation('Floor Supervisor');
    execute insrt_designation('Assistent Manager HouseKeeping');
    execute insrt_designation('Deupty House keeper ');
    execute insrt_designation('Executive house keeper');
    
    --select * from DESIGNATION;

    ---------------------------------------------------- STAFF TABLE  -------------------------------------------

    -- TABLEC REATION PROCEDURE
    create or replace procedure staff_creation is table_name varchar2(4000);
    BEGIN
    -- table creation query
       table_name:='create table STAFF(
                    STAFF_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
                    DESG_ID NUMBER NOT NULL,
                    STAFF_NAME VARCHAR(255) NOT NULL,
                    USR_NM VARCHAR(50) NOT NULL,
                    PASS VARCHAR(50) NOT NULL,
                    DISC_ID NUMBER NOT NULL,
                    DEPT_ID NUMBER NOT NULL,
                    HOTEL_ID NUMBER NOT NULL,
                    primary key(STAFF_ID),
                    constraint FK_DESG_ID FOREIGN key(DESG_ID)REFERENCES DESIGNATION(DESG_ID) ON DELETE CASCADE,
                    constraint FK_DISC_ID  FOREIGN key(DISC_ID)REFERENCES DISCOUNT(DISC_ID) ON DELETE CASCADE,
                    constraint FK_DEPT_ID FOREIGN key(DEPT_ID)REFERENCES DEPARTMENT(DEPT_ID) ON DELETE CASCADE, 
                    constraint FK_HOTEL_ID FOREIGN key(HOTEL_ID)REFERENCES HOTEL(HOTEL_ID) ON DELETE CASCADE
                    )';
       EXECUTE IMMEDIATE table_name;
    end staff_creation;
    /
    
      DECLARE
            tname varchar2(50);
            nCount NUMBER;
        BEGIN
            tname := 'STAFF';
            SELECT count(*) into nCount FROM user_tables where table_name = tname;
            IF(nCount > 0)
            
            THEN
                    DBMS_OUTPUT.PUT_LINE('TABLE STAFF ALREADY EXISTS.');
            ELSE
            -- call to table creation stored procedure 
                begin 
                 staff_creation;
                end;    
            DBMS_OUTPUT.PUT_LINE('TABLE STAFF CREATED.');
            
            END IF;
            exception 
              when no_data_found then
               dbms_output.put_line('table doesnt exits!, So we created one');
               
               -- call to table creation stored procedure 
               begin 
                 staff_creation;
                end; 
                
                when others
                    then
                    dbms_output.put_line('Something went wrong!');
                    dbms_output.put_line(dbms_utility.format_error_stack);
    END;
    /  
    
     create or replace procedure insrt_staff(DESG_ID in NUMBER, STAFF_NAME in varchar, USR_NM in varchar, PASS in varchar, DISC_ID IN NUMBER,DEPT_ID IN NUMBER, HOTEL_ID IN NUMBER)
         as
          begin
             dbms_output.put_line('----------------------------------------------------------');
                insert into STAFF(DESG_ID, STAFF_NAME, USR_NM, PASS, DISC_ID, DEPT_ID, HOTEL_ID) values (DESG_ID, STAFF_NAME, USR_NM, PASS, DISC_ID, DEPT_ID, HOTEL_ID);
             dbms_output.put_line('Row inserted at STAFF table');
                 dbms_output.put_line('----------------------------------------------------------');
            commit;
            exception
            WHEN DUP_VAL_ON_INDEX
            then
             dbms_output.put_line('OOPS! DUPLICATE VALUE FOUND');
            rollback;
                when others then
                    dbms_output.put_line('Error while inserting data in STAFF Table');
                    rollback;
                    dbms_output.put_line('The error encountered is: ');
                    dbms_output.put_line(dbms_utility.format_error_stack);
                    dbms_output.put_line('----------------------------------------------------------');

            end insrt_staff;
     /

    execute insrt_STAFF(1,'JOHN KARL','JHNKRL','PASSWORD1',3,1,1);
    execute insrt_STAFF(1,'Raymond S. Segovia','Ray','PASSWORD2',4,1,1);
    execute insrt_STAFF(2,'Alice M. Lankford','ali','PASSWORD3',2,1,1);
    execute insrt_STAFF(4,'Monika Friedman','Moni','PASSWORD4',1,1,1);
    execute insrt_STAFF(4,'Leo Hussain','LEO','PASSWORD5',3,1,1);
    execute insrt_STAFF(6,'Andrew Johnson','ANDRY','PASSWORD6',6,1,1);
    execute insrt_STAFF(7,'Jordan Fletcher','Jord','PASSWORD7',5,1,1);
    execute insrt_STAFF(9,'Libby McKenzie','LIB','PASSWORD8',2,2,1);
    execute insrt_STAFF(10,'Alexandra Brooks','ALEX','PASSWORD9',2,2,1);
    execute insrt_STAFF(10,'Brandon Baker','BRAND','PASSWORD10',2,2,1);
    execute insrt_STAFF(10,'Rebecca Perry','REB','PASSWORD11',2,2,1);
    execute insrt_STAFF(11,'Connor Johnston','CON','PASSWORD12',3,2,1);
    execute insrt_STAFF(11,'Evie Bryan','EVIE','PASSWORD13',4,2,1);
    execute insrt_STAFF(11,'Sophia Parry','SOP','PASSWORD14',2,2,1);
    execute insrt_STAFF(12,'Jodie Newton','JOD','PASSWORD15',3,2,1);
    execute insrt_STAFF(13,'Adam Lucas','ADAM','PASSWORD16',3,2,1);
    execute insrt_STAFF(3,'Ethan Parsons','ETH','PASSWORD17',2,1,1);
    execute insrt_STAFF(3,'Jennifer Gordon','JEN','PASSWORD18',4,1,1);
    execute insrt_STAFF(3,'Tyler McLean','TYL','PASSWORD19',4,1,1);
    execute insrt_STAFF(6,'Corey Donnelly','COR','PASSWORD20',2,1,1);
    execute insrt_STAFF(5,'Oliver Finch','OLI','PASSWORD21',5,1,1);
    execute insrt_STAFF(8,'Zachary Ryan','ZAC','PASSWORD22',1,1,1);

    --select * from STAFF;
    
---------------------------------------------------- STAFF AVAILABILITY TABLE  -------------------------------------------

    -- TABLE CREATION PROCEDURE
    create or replace procedure staff_avail_creation is table_name varchar2(4000);
   
    BEGIN
    -- table creation query
       table_name:='CREATE TABLE STAFF_AVAIL(STAFF_AVL_ID NUMBER GENERATED BY DEFAULT AS IDENTITY, 
                    STAFF_ID NUMBER NOT NULL,
                    STAFF_STATUS VARCHAR(20) NOT NULL,
                    STAFF_AVL_DT_TIME TIMESTAMP NOT NULL,
                    constraint PK_STAFF_AVL_ID PRIMARY KEY (STAFF_AVL_ID),
                    constraint FK_STAFF_ID FOREIGN KEY (STAFF_ID) REFERENCES STAFF(STAFF_ID))';
       EXECUTE IMMEDIATE table_name;
    end staff_avail_creation;
    /
    
      DECLARE
            tname varchar2(50);
            nCount NUMBER;
        BEGIN
            tname:='STAFF_AVAIL';
            SELECT count(*) into nCount FROM user_tables where table_name = tname;
            IF(nCount > 0)
            
            THEN
                    DBMS_OUTPUT.PUT_LINE('TABLE '||tname || ' ALREADY EXISTS.');
            ELSE
            -- call to table creation stored procedure 
                begin 
                 staff_avail_creation;
                end;    
            DBMS_OUTPUT.PUT_LINE('TABLE ' || tname ||' CREATED.');
            
            END IF;
            exception 
              when no_data_found then
               dbms_output.put_line('Table '||tname ||' doesnt exits! So we created one');
               
               -- call to table creation stored procedure 
               begin 
                 staff_avail_creation;
                end; 
                
                when others
                    then
                    dbms_output.put_line('Something went wrong!');
                    dbms_output.put_line(dbms_utility.format_error_stack);
    END;
    /  
    
    create or replace procedure insrt_staff_avail(STAFF_ID in varchar,STAFF_STATUS IN varchar, STAFF_AVL_DT_TIME IN date)
    AS
          begin
          
                 dbms_output.put_line('----------------------------------------------------------');
                insert into STAFF_AVAIL(STAFF_ID,STAFF_STATUS,STAFF_AVL_DT_TIME) values (STAFF_ID,STAFF_STATUS,STAFF_AVL_DT_TIME);
             dbms_output.put_line('Row inserted at STAFF AVAILABILITY table');
                 dbms_output.put_line('----------------------------------------------------------');
            commit;
            exception
            WHEN DUP_VAL_ON_INDEX
                then
                dbms_output.put_line('Oop! This record already exists');
                ROLLBACK;
                when others then
                    dbms_output.put_line('Error while inserting data in STAFF AVAILABILITY Table');
                    rollback;
                    dbms_output.put_line('The error encountered is: ');
                    dbms_output.put_line(dbms_utility.format_error_stack);
                    dbms_output.put_line('----------------------------------------------------------');
            end insrt_staff_avail;
     /
    
    execute insrt_staff_avail(1,'LEAVE',TO_DATE('2021/05/11 23:59:59', 'yy/mm/dd hh24:mi:ss'));
    execute insrt_staff_avail(2,'AVAILABLE',TO_DATE('2021/05/13 23:59:59', 'yy/mm/dd hh24:mi:ss'));
    execute insrt_staff_avail(3,'LEAVE',TO_DATE('2021/05/02 11:00:59', 'yy/mm/dd hh24:mi:ss'));
    execute insrt_staff_avail(4,'AVAILABLE',TO_DATE('2021/05/03 03:55:00', 'yy/mm/dd hh24:mi:ss'));
    execute insrt_staff_avail(5,'AVAILABLE',TO_DATE('2021/04/29 11:59:59', 'yy/mm/dd hh24:mi:ss'));
    execute insrt_staff_avail(6,'AVAILABLE',TO_DATE('2021/04/29 11:59:59', 'yy/mm/dd hh24:mi:ss'));
    execute insrt_staff_avail(7,'LEAVE',TO_DATE('2021/04/29 11:59:59', 'yy/mm/dd hh24:mi:ss'));
    execute insrt_staff_avail(8,'AVAILABLE',TO_DATE('2021/04/30 11:59:59', 'yy/mm/dd hh24:mi:ss'));
    execute insrt_staff_avail(9,'AVAILABLE',TO_DATE('2021/04/30 11:59:59', 'yy/mm/dd hh24:mi:ss'));
    execute insrt_staff_avail(10,'AVAILABLE',TO_DATE('2021/04/30 11:59:59', 'yy/mm/dd hh24:mi:ss'));
    execute insrt_staff_avail(11,'AVAILABLE',TO_DATE('2021/04/30 11:59:59', 'yy/mm/dd hh24:mi:ss'));
    execute insrt_staff_avail(12,'LEAVE',TO_DATE('2021/04/30 11:59:59', 'yy/mm/dd hh24:mi:ss'));
    execute insrt_staff_avail(13,'AVAILABLE',TO_DATE('2021/04/30 11:59:59', 'yy/mm/dd hh24:mi:ss'));
    execute insrt_staff_avail(14,'AVAILABLE',TO_DATE('2021/04/30 11:59:59', 'yy/mm/dd hh24:mi:ss'));
    execute insrt_staff_avail(15,'AVAILABLE',TO_DATE('2021/04/30 11:59:59', 'yy/mm/dd hh24:mi:ss'));
    execute insrt_staff_avail(16,'AVAILABLE',TO_DATE('2021/04/30 11:59:59', 'yy/mm/dd hh24:mi:ss'));
    execute insrt_staff_avail(17,'LEAVE',TO_DATE('2021/04/30 11:59:59', 'yy/mm/dd hh24:mi:ss'));

    --select * from STAFF_AVAIL;

---------------------------------------------------- Room Type TABLE  -------------------------------------------

create or replace procedure room_type_creation is
    table_name varchar2(4000);
   
    BEGIN
    -- table creation query
       table_name:='CREATE TABLE ROOM_TYPE(
                            ROOM_TYP_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
                            ROOM_TYP_DESC VARCHAR2(255) NOT NULL UNIQUE,
                            NO_OF_BEDS NUMBER NULL,
                            STNDRD_RATE FLOAT NOT NULL,
                            constraint pk_room_typ_id PRIMARY KEY(ROOM_TYP_ID)
                    )';
       EXECUTE IMMEDIATE table_name;
    end room_type_creation;
    /
    
      DECLARE
            tName varchar2(50);
            nCount NUMBER;
        BEGIN
            tName:='ROOM_TYPE';
            SELECT count(*) into nCount FROM user_tables where table_name = tName;
            IF(nCount > 0)
            
            THEN
                    DBMS_OUTPUT.PUT_LINE('TABLE '|| tName||' ALREADY EXISTS.');
            ELSE
            -- call to table creation stored procedure 
                begin 
                 room_type_creation;
                end;    
             DBMS_OUTPUT.PUT_LINE('TABLE '||tName||' CREATED.');
            
            END IF;
            exception 
              when no_data_found then
               dbms_output.put_line('table doesnt exits!, So we created one');
               
               -- call to table creation stored procedure 
               begin 
                 room_type_creation;
                end; 
                
                when others
                    then
                    dbms_output.put_line('Something went wrong!');
                    dbms_output.put_line(dbms_utility.format_error_stack);
    END;
    /  
    
     create or replace procedure insrt_room_type(roomtype_desc_name in varchar2,no_of_beds_name in number,standard_rate_name in float)
         as
          begin
                 dbms_output.put_line('----------------------------------------------------------');
                  insert into ROOM_TYPE(ROOM_TYP_DESC,NO_OF_BEDS,STNDRD_RATE) values (roomtype_desc_name,no_of_beds_name,standard_rate_name);
                 dbms_output.put_line('Row inserted at RoomType table');
                 dbms_output.put_line('----------------------------------------------------------');
            commit;
            exception
            WHEN DUP_VAL_ON_INDEX
                then
                dbms_output.put_line('Oop! This record already exists');
                rollback;
                when others then
                    dbms_output.put_line('Error while inserting data in RoomType Table');
                    rollback;
                    dbms_output.put_line('The error encountered is: ');
                    dbms_output.put_line(dbms_utility.format_error_stack);
                    dbms_output.put_line('----------------------------------------------------------');
            end insrt_room_type;
     /
 
     execute insrt_room_type('Delux',2,1500);
     execute insrt_room_type('PentHouse',4,5000);
     execute insrt_room_type('Presidential Suite',4,10000);  
     execute insrt_room_type('Studio',1,1000);       
     
     --select * from room_type;

---------------------------------------------------- Room Status -------------------------------------------

-- TABLE CREATION PROCEDURE
    create or replace procedure room_status_creation is
    table_name varchar2(4000);
   -- ROOM_STS_TIMESTAMP TIMESTAMP NOT NULL,
    BEGIN
    -- table creation query
       table_name:='CREATE TABLE ROOM_STATUS(
                            ROOM_STS_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
                            ROOM_STS VARCHAR2(50) NOT NULL,
                            constraint pk_room_status_id PRIMARY KEY(ROOM_STS_ID)
                    )';
       EXECUTE IMMEDIATE table_name;
    end room_status_creation;
    /
    
      DECLARE
            table_name varchar2(50);
            nCount NUMBER;
        BEGIN
            table_name:='ROOM_STATUS';
            SELECT count(*) into nCount FROM user_tables where table_name = 'ROOM_STATUS';
            IF(nCount > 0)
            
            THEN
                    DBMS_OUTPUT.PUT_LINE('TABLE '|| table_name ||' ALREADY EXISTS.');
            ELSE
            -- call to table creation stored procedure 
                begin 
                 room_status_creation;
                end;    
            DBMS_OUTPUT.PUT_LINE('TABLE ' ||table_name ||' CREATED');
            
            END IF;
            exception 
              when no_data_found then
               dbms_output.put_line('table doesnt exits!, So we created one');
               
               -- call to table creation stored procedure 
               begin 
                 room_status_creation;
                end; 
                
                when others
                    then
                    dbms_output.put_line('Something went wrong!');
                    dbms_output.put_line(dbms_utility.format_error_stack);
    END;
    /  
    
     create or replace procedure insrt_room_status(room_status in varchar)
         as
          begin
                 dbms_output.put_line('----------------------------------------------------------');
                insert into  ROOM_STATUS(ROOM_STS) values (room_status);
             dbms_output.put_line('Row inserted at ROOM_STATUS table');
                 dbms_output.put_line('----------------------------------------------------------');
            commit;
            exception
                WHEN DUP_VAL_ON_INDEX
                then
                dbms_output.put_line('Oop! This record already exists');
                rollback;
                when others then
                    dbms_output.put_line('Error while inserting data in Room Status Table');
                    rollback;
                    dbms_output.put_line('The error encountered is: ');
                    dbms_output.put_line(dbms_utility.format_error_stack);
                    dbms_output.put_line('----------------------------------------------------------');
            end insrt_room_status;
     /
     
    execute insrt_room_status('Clean');
    execute insrt_room_status('Not Clean');
    execute insrt_room_status('Cleaning in Progress');
    execute insrt_room_status('Out of Order');

    --execute insrt_room_status(SYSDATE,'Clean');
    --execute insrt_room_status(SYSDATE,'Not Clean');
    --execute insrt_room_status(SYSDATE,'Cleaning in Progress');
    --execute insrt_room_status(SYSDATE,'Out of Order');
    
    --select * from room_status;

---------------------------------------------------- Rack Rate Card -------------------------------------------
    -- TABLEC REATION PROCEDURE
    create or replace procedure rack_rate_card_creation is
    table_name varchar2(4000);
   
    BEGIN
    -- table creation query
       table_name:= 'CREATE TABLE RACK_RATECARD(
            RACK_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
            RACK_AMOUNT FLOAT NOT NULL unique,
            constraint PK_RACK_ID PRIMARY KEY(RACK_ID)
            )';

    EXECUTE IMMEDIATE table_name;
    end rack_rate_card_creation;
    /
    
      DECLARE
            table_name varchar2(50);
            nCount NUMBER;
        BEGIN
            table_name:= 'RACK_RATECARD';
            SELECT count(*) into nCount FROM user_tables where table_name = 'RACK_RATECARD';
            IF(nCount > 0)
            
            THEN
                    DBMS_OUTPUT.PUT_LINE('TABLE '||table_name ||' ALREADY EXISTS.');
            ELSE
            -- call to table creation stored procedure 
                begin 
                 rack_rate_card_creation;
                end;    
            DBMS_OUTPUT.PUT_LINE('TABLE '||TABLE_NAME||' CREATED.');
            
            END IF;
            exception 
              when no_data_found then
               dbms_output.put_line('table doesnt exits!, So we created one');
               
               -- call to table creation stored procedure 
               begin 
                 rack_rate_card_creation;
                end; 
                
                when others
                    then
                    dbms_output.put_line('Something went wrong!');
                    dbms_output.put_line(dbms_utility.format_error_stack);
    END;
    /  
    
     create or replace procedure insrt_rack_ratecard(RACK_AMOUNT_name in FLOAT)
         as
          begin
                 dbms_output.put_line('----------------------------------------------------------');
                insert into  RACK_RATECARD(RACK_AMOUNT) values (RACK_AMOUNT_name);
             dbms_output.put_line('Row inserted at RACK_RATECARD table');
                 dbms_output.put_line('----------------------------------------------------------');
            commit;
            exception
            WHEN DUP_VAL_ON_INDEX
                then
                dbms_output.put_line('Oop! This record already exists');
                rollback;
                when others then
                    dbms_output.put_line('Error while inserting data in RACK RATECARD Table');
                    rollback;
                    dbms_output.put_line('The error encountered is: ');
                    dbms_output.put_line(dbms_utility.format_error_stack);
                    dbms_output.put_line('----------------------------------------------------------');
            end insrt_rack_ratecard;
     /

    execute insrt_rack_ratecard(2000);
    execute insrt_rack_ratecard(2500);
    execute insrt_rack_ratecard(3000);
    execute insrt_rack_ratecard(3500);
    execute insrt_rack_ratecard(4000);
    execute insrt_rack_ratecard(4500);
    execute insrt_rack_ratecard(5000);
    execute insrt_rack_ratecard(5500);
    execute insrt_rack_ratecard(6000);
    execute insrt_rack_ratecard(6500);
    execute insrt_rack_ratecard(7000);
    execute insrt_rack_ratecard(7500);
    execute insrt_rack_ratecard(8000);
    execute insrt_rack_ratecard(8500);
    execute insrt_rack_ratecard(9000);
    execute insrt_rack_ratecard(9500);
    execute insrt_rack_ratecard(10000); 
    
    --select * from RACK_RATECARD;

---------------------------------------------------- Annual Rate Card -------------------------------------------

-- TABLE CREATION PROCEDURE
    create or replace procedure annual_rate_creation is
    table_name varchar2(4000);
   
    BEGIN
    -- table creation query
       table_name:='CREATE TABLE ANNUAL_RATE(
                            ANNUAL_RATE_ID  NUMBER GENERATED BY DEFAULT AS IDENTITY,
                            RACK_ID NUMBER NOT NULL,
                            ANNUAL_RATE_DATE DATE NOT NULL,
                            HOTEL_ID NUMBER NOT NULL,
                            constraint pk_annual_rate_id PRIMARY KEY(ANNUAL_RATE_ID),
                            constraint fk_rk_id FOREIGN KEY(RACK_ID) REFERENCES rack_ratecard(rack_id),
                            constraint fk_htl_id FOREIGN KEY(HOTEL_ID) REFERENCES hotel(hotel_id),
                            constraint unique_rate unique (ANNUAL_RATE_DATE, HOTEL_ID)
                    )';
       EXECUTE IMMEDIATE table_name;
    end annual_rate_creation;
    /
    
      DECLARE
            table_name varchar2(50);
            nCount NUMBER;
        BEGIN
            table_name:='ANNUAL_RATE';
            SELECT count(*) into nCount FROM user_tables where table_name = 'ANNUAL_RATE';
            IF(nCount > 0)
            
            THEN
                    DBMS_OUTPUT.PUT_LINE('TABLE '|| table_name ||' ALREADY EXISTS.');
            ELSE
            -- call to table creation stored procedure 
                begin 
                 annual_rate_creation;
                end;    
            DBMS_OUTPUT.PUT_LINE('TABLE ' ||table_name ||' CREATED');
            
            END IF;
            exception 
              when no_data_found then
               dbms_output.put_line('table doesnt exits!, So we created one');
               
               -- call to table creation stored procedure 
               begin 
                 annual_rate_creation;
                end; 
                
                when others
                    then
                    dbms_output.put_line('Something went wrong!');
                    dbms_output.put_line(dbms_utility.format_error_stack);
    END;
    /  
    
     create or replace procedure insrt_annual_rate(rack_id_name in number, annual_rate_date in timestamp,hotel_id_name in number)
         as
          begin
                 dbms_output.put_line('----------------------------------------------------------');
                insert into  ANNUAL_RATE(RACK_ID, ANNUAL_RATE_DATE,HOTEL_ID) values (rack_id_name, annual_rate_date,hotel_id_name);
             dbms_output.put_line('Row inserted at Annual Rate table');
                 dbms_output.put_line('----------------------------------------------------------');
            commit;
            exception
                WHEN DUP_VAL_ON_INDEX
                then
                dbms_output.put_line('Oop! This record already exists');
                rollback;
                when others then
                    dbms_output.put_line('Error while inserting data in Annual Rate Table');
                    rollback;
                    dbms_output.put_line('The error encountered is: ');
                    dbms_output.put_line(dbms_utility.format_error_stack);
                    dbms_output.put_line('----------------------------------------------------------');
            end insrt_annual_rate;
     /

    execute insrt_annual_rate(1,TO_DATE('2021/01/01 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
    execute insrt_annual_rate(7,TO_DATE('2021/01/02 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
     execute insrt_annual_rate(16,TO_DATE('2021/01/03 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
    execute insrt_annual_rate(17,TO_DATE('2021/01/04 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
   -- execute insrt_annual_rate(18,TO_DATE('2021/01/05 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
    execute insrt_annual_rate(17,TO_DATE('2021/01/06 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
    execute insrt_annual_rate(14,TO_DATE('2021/01/07 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
     execute insrt_annual_rate(1,TO_DATE('2021/01/08 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
    execute insrt_annual_rate(7,TO_DATE('2021/01/09 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
     execute insrt_annual_rate(16,TO_DATE('2021/01/10 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
      execute insrt_annual_rate(2,TO_DATE('2021/02/11 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
    execute insrt_annual_rate(4,TO_DATE('2021/02/12 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
     execute insrt_annual_rate(9,TO_DATE('2021/02/13 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
    execute insrt_annual_rate(17,TO_DATE('2021/02/14 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
    execute insrt_annual_rate(10,TO_DATE('2021/02/15 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
    execute insrt_annual_rate(8,TO_DATE('2021/02/16 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
    execute insrt_annual_rate(6,TO_DATE('2021/02/17 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
     execute insrt_annual_rate(1,TO_DATE('2021/02/18 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
    execute insrt_annual_rate(7,TO_DATE('2021/02/19 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
     execute insrt_annual_rate(13,TO_DATE('2021/02/20 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
      execute insrt_annual_rate(9,TO_DATE('2021/03/21 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
    execute insrt_annual_rate(5,TO_DATE('2021/03/22 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
     execute insrt_annual_rate(12,TO_DATE('2021/03/23 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
    execute insrt_annual_rate(10,TO_DATE('2021/03/24 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
    execute insrt_annual_rate(10,TO_DATE('2021/03/25 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
    execute insrt_annual_rate(16,TO_DATE('2021/03/26 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
    execute insrt_annual_rate(14,TO_DATE('2021/03/27 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
     execute insrt_annual_rate(2,TO_DATE('2021/03/28 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
    execute insrt_annual_rate(7,TO_DATE('2021/03/29 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
     execute insrt_annual_rate(15,TO_DATE('2021/03/30 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
	 
	  execute insrt_annual_rate(1,TO_DATE('2021/01/01 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    execute insrt_annual_rate(7,TO_DATE('2021/01/02 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
     execute insrt_annual_rate(16,TO_DATE('2021/01/03 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    execute insrt_annual_rate(17,TO_DATE('2021/01/04 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    execute insrt_annual_rate(18,TO_DATE('2021/01/05 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    execute insrt_annual_rate(17,TO_DATE('2021/01/06 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    execute insrt_annual_rate(14,TO_DATE('2021/01/07 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
     execute insrt_annual_rate(1,TO_DATE('2021/01/08 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    execute insrt_annual_rate(7,TO_DATE('2021/01/09 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
     execute insrt_annual_rate(16,TO_DATE('2021/01/10 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    
      execute insrt_annual_rate(2,TO_DATE('2021/02/11 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    execute insrt_annual_rate(4,TO_DATE('2021/02/12 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
     execute insrt_annual_rate(9,TO_DATE('2021/02/13 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    execute insrt_annual_rate(17,TO_DATE('2021/02/14 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    execute insrt_annual_rate(10,TO_DATE('2021/02/15 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    execute insrt_annual_rate(8,TO_DATE('2021/02/16 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    execute insrt_annual_rate(6,TO_DATE('2021/02/17 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
     execute insrt_annual_rate(1,TO_DATE('2021/02/18 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    execute insrt_annual_rate(7,TO_DATE('2021/02/19 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
     execute insrt_annual_rate(13,TO_DATE('2021/02/20 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    
      execute insrt_annual_rate(9,TO_DATE('2021/03/21 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    execute insrt_annual_rate(5,TO_DATE('2021/03/22 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
     execute insrt_annual_rate(12,TO_DATE('2021/03/23 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    execute insrt_annual_rate(10,TO_DATE('2021/03/24 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    execute insrt_annual_rate(10,TO_DATE('2021/03/25 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    execute insrt_annual_rate(16,TO_DATE('2021/03/26 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    execute insrt_annual_rate(14,TO_DATE('2021/03/27 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
     execute insrt_annual_rate(2,TO_DATE('2021/03/28 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    execute insrt_annual_rate(7,TO_DATE('2021/03/29 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
     execute insrt_annual_rate(15,TO_DATE('2021/03/30 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);

    --select * from annual_rate;

---------------------------------------------------- Room -------------------------------------------

-- TABLE CREATION PROCEDURE
    create or replace procedure ROOM_creation is table_name varchar2(4000);
   
    BEGIN
    -- table creation query
       table_name:='create table ROOM(
                    ROOM_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
                    ROOM_TYP_ID NUMBER ,
                    ROOM_AVL_STS CHAR(1),
                    ROOM_LVL NUMBER,
                    AMENITY_ID NUMBER,
                    HOTEL_ID NUMBER,
                    ROOM_STS_ID NUMBER,
                    constraint pk_room_id  PRIMARY KEY (ROOM_ID),
                    constraint fk_sts_id  FOREIGN KEY (ROOM_STS_ID) REFERENCES ROOM_STATUS(ROOM_STS_ID),
                    constraint fk_room_type_id FOREIGN KEY (ROOM_TYP_ID) REFERENCES ROOM_TYPE(ROOM_TYP_ID),
                    constraint fk_hotel_id FOREIGN KEY (HOTEL_ID) REFERENCES HOTEL(HOTEL_ID),
                    constraint fk_amenity__id FOREIGN KEY (AMENITY_ID) REFERENCES AMENITY(AMENITY_ID)
                    )';
                    
       EXECUTE IMMEDIATE table_name;
    end ROOM_creation;
    /
    
      DECLARE
            tname varchar2(50);
            nCount NUMBER;
        BEGIN
            TNAME:='ROOM';
            SELECT count(*) into nCount FROM user_tables where table_name = TNAME;
            IF(nCount > 0)
            
            THEN
                    DBMS_OUTPUT.PUT_LINE('TABLE '||TNAME || ' ALREADY EXISTS.');
            ELSE
            -- call to table creation stored procedure 
                begin 
                 ROOM_creation;
                end;    
            DBMS_OUTPUT.PUT_LINE('TABLE ' || TNAME ||' CREATED.');
            
            END IF;
            exception 
              when no_data_found then
               dbms_output.put_line('Table '||TNAME ||' doesnt exits! So we created one');
               
               -- call to table creation stored procedure 
               begin 
                 ROOM_creation;
                end; 
                
                when others
                    then
                    dbms_output.put_line('Something went wrong!');
                    dbms_output.put_line(dbms_utility.format_error_stack);
    END;
    /  
    
    create or replace procedure insrt_ROOM(ROOM_TYP_ID IN NUMBER ,ROOM_AVL_STS  IN CHAR, ROOM_LVL IN NUMBER,AMENITY_ID IN NUMBER ,HOTEL_ID IN NUMBER, ROOM_STS_ID IN NUMBER)
         as
          begin
          
                 dbms_output.put_line('----------------------------------------------------------');
                insert into ROOM(ROOM_TYP_ID, ROOM_AVL_STS, ROOM_LVL, AMENITY_ID, HOTEL_ID, ROOM_STS_ID) values (ROOM_TYP_ID, ROOM_AVL_STS, ROOM_LVL, AMENITY_ID, HOTEL_ID, ROOM_STS_ID);
             dbms_output.put_line('Row inserted at ROOM table');
                 dbms_output.put_line('----------------------------------------------------------');
            commit;
            exception
            WHEN DUP_VAL_ON_INDEX
                then
                dbms_output.put_line('Oops! This record already exists');
                ROLLBACK;
                when others then
                    dbms_output.put_line('Error while inserting data in Room Table');
                    rollback;
                    dbms_output.put_line('The error encountered is: ');
                    dbms_output.put_line(dbms_utility.format_error_stack);
                    dbms_output.put_line('----------------------------------------------------------');
            end insrt_ROOM;
     /
     
    execute insrt_room(2,'Available',16,10,1,1); 
    --Room_typ_id, room_avl,room_level,amenity,hotel_id,room_sts_id
    execute insrt_room(3,'Available',19,3,11,2);
    execute insrt_room(4,'Available',2,3,8,2,1);
    execute insrt_room(1,'Available',1,3,9,2,2);
    execute insrt_room(2,'Available',8,3,4,2,1);
    execute insrt_room(3,'Available',9,3,9,1,1);
    execute insrt_room(1,'Available',8,3,11,1,2);
    execute insrt_room(1,'Available',9,3,11,1,2);
    execute insrt_room(3,'Available',7,3,9,1,1);
    execute insrt_room(1,'Available',11,3,9,1,2);
    execute insrt_room(1,'Available',15,3,9,1,1);
    execute insrt_room(1,'Available',3,3,9,1,2);
    execute insrt_room(1,'Available',5,3,11,1,2);

    --execute insrt_room(1,'Y',4,1,1);
    --execute insrt_room(1,'N',3,2,1);
    --execute insrt_room(1,'Y',10,3,1);
    --execute insrt_room(2,'N',12,4,2);
    --execute insrt_room(3,'Y',2,5,2);

    --select * from room;

    ---------------------------------------------------- house keeping -------------------------------------------

     create or replace procedure house_keeping_creation is
    table_name varchar2(4000);
   
    BEGIN
    -- table creation query
       table_name:='CREATE TABLE HOUSE_KEEPING(
                            HK_ID  NUMBER GENERATED BY DEFAULT AS IDENTITY,
                            ROOM_ID  NUMBER NOT NULL,
                            HK_TIME TIMESTAMP NOT NULL,
                            STAFF_ID NUMBER NOT NULL,
                            constraint pk_hk_id PRIMARY KEY(HK_ID),
                            constraint fk_room_id FOREIGN KEY(ROOM_ID) REFERENCES room (room_id),
                            constraint fk_stf_id FOREIGN KEY(STAFF_ID) REFERENCES staff (staff_id)
                    )';
       EXECUTE IMMEDIATE table_name;
    end house_keeping_creation;
    /
    
      DECLARE
      
            table_name varchar2(50);
            nCount NUMBER;
        BEGIN
            table_name:='HOUSE_KEEPING';
            SELECT count(*) into nCount FROM user_tables where table_name = 'HOUSE_KEEPING';
            IF(nCount > 0)
            
            THEN
                    DBMS_OUTPUT.PUT_LINE('TABLE '|| table_name||' ALREADY EXISTS.');
            ELSE
            -- call to table creation stored procedure 
                begin 
                 house_keeping_creation;
                end;    
             DBMS_OUTPUT.PUT_LINE('TABLE '||table_name||' CREATED.');
            
            END IF;
            exception 
              when no_data_found then
               dbms_output.put_line('table doesnt exits!, So we created one');
               
               -- call to table creation stored procedure 
               begin 
                 house_keeping_creation;
                end; 
                
                when others
                    then
                    dbms_output.put_line('Something went wrong!');
                    dbms_output.put_line(dbms_utility.format_error_stack);
    END;
    /  
    
     create or replace procedure insrt_house_keeping(room_id_name in number,hk_timestamp in timestamp,staff_id in number)
         as
          begin
                 dbms_output.put_line('----------------------------------------------------------');
                insert into admin.HOUSE_KEEPING(ROOM_ID,HK_TIME,STAFF_ID) values (room_id_name,hk_timestamp,staff_id);
             dbms_output.put_line('Row inserted at HOUSE_KEEPING table');
                 dbms_output.put_line('----------------------------------------------------------');
            commit;
            exception
                WHEN DUP_VAL_ON_INDEX
                then
                dbms_output.put_line('Oop! This record already exists');
                rollback;
                when others then
                    dbms_output.put_line('Error while inserting data in HOUSE_KEEPING Table');
                    rollback;
                    dbms_output.put_line('The error encountered is: ');
                    dbms_output.put_line(dbms_utility.format_error_stack);
                    dbms_output.put_line('----------------------------------------------------------');
            end insrt_house_keeping;
     /
     
     execute admin.insrt_house_keeping(1,TO_DATE('2021/04/29 10:59:59', 'yyyy/mm/dd hh24:mi:ss'),1);
     execute admin.insrt_house_keeping(1,TO_DATE('2021/04/28 11:40:59', 'yyyy/mm/dd hh24:mi:ss'),2);
     execute admin.insrt_house_keeping(2,TO_DATE('2021/04/26 09:45:59', 'yyyy/mm/dd hh24:mi:ss'),2);
     execute admin.insrt_house_keeping(2,TO_DATE('2021/04/29 10:30:59', 'yyyy/mm/dd hh24:mi:ss'),3);
    execute admin.insrt_house_keeping(3,TO_DATE('2021/04/27 05:10:59', 'yyyy/mm/dd hh24:mi:ss'),10);
    execute admin.insrt_house_keeping(3,TO_DATE('2021/04/28 01:25:59', 'yyyy/mm/dd hh24:mi:ss'),8);
    execute admin.insrt_house_keeping(3,TO_DATE('2021/04/29 21:59:59', 'yyyy/mm/dd hh24:mi:ss'),15);
    execute admin.insrt_house_keeping(4,TO_DATE('2021/04/28 18:30:59', 'yyyy/mm/dd hh24:mi:ss'),11);
    execute admin.insrt_house_keeping(4,TO_DATE('2021/04/27 20:20:59', 'yyyy/mm/dd hh24:mi:ss'),5);
    execute admin.insrt_house_keeping(1,TO_DATE('2021/04/29 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),5);
    execute admin.insrt_house_keeping(5,TO_DATE('2021/04/28 21:15:59', 'yyyy/mm/dd hh24:mi:ss'),1);
    execute admin.insrt_house_keeping(7,TO_DATE('2021/04/29 09:25:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    execute admin.insrt_house_keeping(7,TO_DATE('2021/04/28 12:59:59', 'yyyy/mm/dd hh24:mi:ss'),2);
    execute admin.insrt_house_keeping(4,TO_DATE('2021/04/29 17:35:59', 'yyyy/mm/dd hh24:mi:ss'),3);
    execute admin.insrt_house_keeping(8,TO_DATE('2021/04/27 21:45:59', 'yyyy/mm/dd hh24:mi:ss'),5);
    execute admin.insrt_house_keeping(8,TO_DATE('2021/04/27 18:20:59', 'yyyy/mm/dd hh24:mi:ss'),6);
    execute admin.insrt_house_keeping(5,TO_DATE('2021/04/28 13:13:59', 'yyyy/mm/dd hh24:mi:ss'),6);
    execute admin.insrt_house_keeping(5,TO_DATE('2021/04/28 14:14:59', 'yyyy/mm/dd hh24:mi:ss'),8);
    execute admin.insrt_house_keeping(6,TO_DATE('2021/04/29 16:16:59', 'yyyy/mm/dd hh24:mi:ss'),8);
    execute admin.insrt_house_keeping(6,TO_DATE('2021/04/29 07:45:59', 'yyyy/mm/dd hh24:mi:ss'),11);
    execute admin.insrt_house_keeping(2,TO_DATE('2021/04/27 09:59:59', 'yyyy/mm/dd hh24:mi:ss'),11);
    execute admin.insrt_house_keeping(2,TO_DATE('2021/04/27 12:45:59', 'yyyy/mm/dd hh24:mi:ss'),7);
    execute admin.insrt_house_keeping(1,TO_DATE('2021/04/28 22:59:59', 'yyyy/mm/dd hh24:mi:ss'),7);
    execute admin.insrt_house_keeping(3,TO_DATE('2021/04/28 20:30:59', 'yyyy/mm/dd hh24:mi:ss'),3);
    execute admin.insrt_house_keeping(3,TO_DATE('2021/04/29 06:45:59', 'yyyy/mm/dd hh24:mi:ss'),3);
    execute admin.insrt_house_keeping(8,TO_DATE('2021/04/29 03:59:59', 'yyyy/mm/dd hh24:mi:ss'),5);
    execute admin.insrt_house_keeping(4,TO_DATE('2021/04/28 10:35:59', 'yyyy/mm/dd hh24:mi:ss'),5);
    execute admin.insrt_house_keeping(3,TO_DATE('2021/04/28 23:45:59', 'yyyy/mm/dd hh24:mi:ss'),9);
    execute admin.insrt_house_keeping(3,TO_DATE('2021/04/27 15:16:59', 'yyyy/mm/dd hh24:mi:ss'),6);
    execute admin.insrt_house_keeping(3,TO_DATE('2021/04/29 08:12:59', 'yyyy/mm/dd hh24:mi:ss'),6);
    execute admin.insrt_house_keeping(2,TO_DATE('2021/04/28 13:14:59', 'yyyy/mm/dd hh24:mi:ss'),9);
    execute admin.insrt_house_keeping(2,TO_DATE('2021/04/27 05:20:59', 'yyyy/mm/dd hh24:mi:ss'),9);
     --execute insrt_house_keeping(2,TO_DATE('2021/05/11 10:59:59', 'yyyy/mm/dd hh24:mi:ss'),3);
     --execute insrt_house_keeping(3,TO_DATE('2021/04/26 09:45:59', 'yyyy/mm/dd hh24:mi:ss'),5);
     --execute insrt_house_keeping(4,TO_DATE('2021/05/01 20:30:59', 'yyyy/mm/dd hh24:mi:ss'),9);
     --execute insrt_house_keeping(5,TO_DATE('2021/05/29 05:10:59', 'yyyy/mm/dd hh24:mi:ss'),10);
     --execute insrt_house_keeping(6,TO_DATE('2021/05/20 15:05:59', 'yyyy/mm/dd hh24:mi:ss'),4);
     
     --select * from house_keeping;

---------------------------------------------------- Booking type -------------------------------------------

 -- TABLEC REATION PROCEDURE
    create or replace procedure BOOKING_TYPE_CREATION is
    table_name varchar2(4000);
   
    BEGIN
    -- table creation query
       table_name:='create table BOOKING_TYPE(  
                    bkng_typ_id NUMBER GENERATED BY DEFAULT AS IDENTITY ,  
                    bkng_typ varchar2(20) unique NOT NULL,
                    constraint pk_bkng_tp_id primary key (bkng_typ_id)  
                    )';
                    
       EXECUTE IMMEDIATE table_name;
    end BOOKING_TYPE_CREATION;
    /
    
      DECLARE
            table_name varchar2(50);
            nCount NUMBER;
        BEGIN
            SELECT count(*) into nCount FROM user_tables where table_name = 'BOOKING_TYPE';
            IF(nCount > 0)
            
            THEN
                    DBMS_OUTPUT.PUT_LINE('TABLE BOOKING TYPE ALREADY EXISTS.');
            ELSE
            -- call to table creation stored procedure 
                begin 
                 BOOKING_TYPE_CREATION;
                end;    
            DBMS_OUTPUT.PUT_LINE('TABLE BOOKING TYPE CREATED.');
            
            END IF;
            exception 
              when no_data_found then
               dbms_output.put_line('table doesnt exits!, So we created one');
               
               -- call to table creation stored procedure 
               begin 
                 BOOKING_TYPE_CREATION;
                end; 
                
                when others
                    then
                    dbms_output.put_line('Something went wrong!');
                    dbms_output.put_line(dbms_utility.format_error_stack);
    END;
    /  
    
     create or replace procedure insrt_Booking_Type(bkng_typ_name in varchar)
         as
          begin
                 dbms_output.put_line('----------------------------------------------------------');
                insert into BOOKING_TYPE(bkng_typ) values (bkng_typ_name);
             dbms_output.put_line('Row inserted at BOOKING_TYPE table');
                 dbms_output.put_line('----------------------------------------------------------');
            commit;
            exception
            WHEN DUP_VAL_ON_INDEX
                then
                dbms_output.put_line('Oop! This record already exists');
                rollback;
                when others then
                    dbms_output.put_line('Error while inserting data in BOOKING_TYPE Table');
                    rollback;
                    dbms_output.put_line('The error encountered is: ');
                    dbms_output.put_line(dbms_utility.format_error_stack);
                    dbms_output.put_line('----------------------------------------------------------');
            end insrt_Booking_Type;
     /
    
    
    -- TABLEC REATION PROCEDURE
    create or replace procedure BOOKING_TYPE_CREATION is
    table_name varchar2(4000);
   
    BEGIN
    -- table creation query
       table_name:='create table BOOKING_TYPE(  
                    bkng_typ_id NUMBER GENERATED BY DEFAULT AS IDENTITY ,  
                    bkng_typ varchar2(20) unique NOT NULL,
                    constraint pk_bkng_tp_id primary key (bkng_typ_id)  
                    )';
                    
       EXECUTE IMMEDIATE table_name;
    end BOOKING_TYPE_CREATION;
    /
    
      DECLARE
            table_name varchar2(50);
            nCount NUMBER;
        BEGIN
            SELECT count(*) into nCount FROM user_tables where table_name = 'BOOKING_TYPE';
            IF(nCount > 0)
            
            THEN
                    DBMS_OUTPUT.PUT_LINE('TABLE TABLE_NAME ALREADY EXISTS.');
            ELSE
            -- call to table creation stored procedure 
                begin 
                 BOOKING_TYPE_CREATION;
                end;    
            DBMS_OUTPUT.PUT_LINE('TABLE TABLE_NAME CREATED.');
            
            END IF;
            exception 
              when no_data_found then
               dbms_output.put_line('table doesnt exits!, So we created one');
               
               -- call to table creation stored procedure 
               begin 
                 BOOKING_TYPE_CREATION;
                end; 
                
                when others
                    then
                    dbms_output.put_line('Something went wrong!');
                    dbms_output.put_line(dbms_utility.format_error_stack);
    END;
    /  
    
     create or replace procedure insrt_Booking_Type(bkng_typ_name in varchar)
         as
          begin
                 dbms_output.put_line('----------------------------------------------------------');
                insert into BOOKING_TYPE(bkng_typ) values (bkng_typ_name);
             dbms_output.put_line('Row inserted at BOOKING_TYPE table');
                 dbms_output.put_line('----------------------------------------------------------');
            commit;
            exception
            WHEN DUP_VAL_ON_INDEX
                then
                dbms_output.put_line('Oop! This record already exists');
                rollback;
                when others then
                    dbms_output.put_line('Error while inserting data in BOOKING_TYPE Table');
                    rollback;
                    dbms_output.put_line('The error encountered is: ');
                    dbms_output.put_line(dbms_utility.format_error_stack);
                    dbms_output.put_line('----------------------------------------------------------');
            end insrt_Booking_Type;
     /
    
    execute insrt_Booking_Type('INTERNET');
    execute insrt_Booking_Type('WALK-IN');
    execute insrt_Booking_Type('REFERRAL');
    
    --select * from BOOKING_TYPE ;

    
--select * from BOOKING_TYPE ;

---------------------------------------------------- VIEWS -------------------------------------------

---------------------------------------------------- GUEST DISCOUNT -------------------------------------------

     CREATE or replace VIEW GUEST_DISCOUNT AS
        select c.guest_id,guest_name,mem_type, disc_value
            from
        (select a.guest_id, a. guest_name, b.mem_type, b.Disc_id
            from
        guest a
            join member b
            on a.mem_id = b. mem_id) c
            join discount d
        on c. disc_id = d.disc_id;

---------------------------------------------------- HOTEL RATES -------------------------------------------

create or replace view HOTEL_RATES AS
    select a.rack_amount,b.* from
        rack_ratecard a
          join
        annual_rate b
    on b.rack_id = a.rack_id;

---------------------------------------------------- Room Booking -------------------------------------------
    -- ROOM BOOKING AMOUNT CALCULATION FUNCTION CREATION    
CREATE OR REPLACE 
    FUNCTION GET_BOOKING_AMOUNT(
        typ_id NUMBER,
        no_of_rooms NUMBER,
        no_of_guests NUMBER,
        amenity__id NUMBER,
        guest__id NUMBER,
        h_id NUMBER,
        b_start_date DATE,
        b_end_date DATE
    )
    
    RETURN NUMBER
        IS
        B_TOTAL_WITHOUT_DISCOUNT_AMOUNT NUMBER := 0;
        
        B_TOTAL_AMOUNT NUMBER := 0;
        B_TODAY_RATE NUMBER := 5000;
        B_ROOM_AMOUNT NUMBER := 0;
        B_AMENITY_AMOUNT NUMBER := 0;
        B_IS_AMENITY_PERSON_SPECIFIC CHAR := 'y';
        B_DISCOUNT_AMOUNT NUMBER := 0;
        
        B_TOTAL_AMENITY_AMOUNT NUMBER := 0;
        B_TOTAL_ROOM_AMOUNT NUMBER := 0;

        B_NO_DAYS NUMBER:= 1;
        
        BEGIN
        
       -- DBMS_OUTPUT.PUT_LINE('room_typ_id: ' || typ_id || ' no_of_rooms : ' || no_of_rooms || ' no_of_guests : ' || no_of_guests || ' amenity_id : ' || amenity__id);
        
            dbms_output.put_line('----------------------------------------------------------');

        -- CALCULATE STAY PERIOD
             BEGIN
                IF b_end_date != b_start_date THEN
                    -- B_NO_DAYS :=  TO_DATE(b_end_date, 'YYYY-MM-DD') - TO_DATE(b_start_date, 'YYYY-MM-DD');
                     B_NO_DAYS := b_end_date - b_start_date;
                ELSE 
                 B_NO_DAYS := 1;
                 END IF;
                 
            EXCEPTION
                WHEN OTHERS THEN
                B_NO_DAYS := 1;
            END;

            DBMS_OUTPUT.PUT_LINE('Stay Period => ' || B_NO_DAYS || ' days');
            DBMS_OUTPUT.PUT_LINE('Number of guests => ' || no_of_guests);
            DBMS_OUTPUT.PUT_LINE('Number of rooms => ' || no_of_rooms);

            -- CALCULATE ROOM TYPE RATE
        BEGIN
            SELECT 
                    STNDRD_RATE
               INTO 
                    B_ROOM_AMOUNT 
               FROM 
                    admin.ROOM_TYPE WHERE ROOM_TYP_ID = typ_id;
                    
            EXCEPTION
                      WHEN NO_DATA_FOUND THEN
                        B_ROOM_AMOUNT := 0;
         END;
                    
            DBMS_OUTPUT.PUT_LINE('Room type rate is: ' || B_ROOM_AMOUNT);
               
        BEGIN
         SELECT 
                amenity_price, 
                IS_PRSN_SPC 
            INTO 
                B_AMENITY_AMOUNT, 
                B_IS_AMENITY_PERSON_SPECIFIC FROM admin.AMENITY WHERE AMENITY_ID = amenity__id;
                
                 EXCEPTION
                      WHEN NO_DATA_FOUND THEN
                        B_AMENITY_AMOUNT := 0;
                        B_IS_AMENITY_PERSON_SPECIFIC := 'n';
         END;
         
           DBMS_OUTPUT.PUT_LINE('AMENITY AMOUNT: ' || B_AMENITY_AMOUNT);
           DBMS_OUTPUT.PUT_LINE('IS AMENITY PERSON SPECIFIC: ' || B_IS_AMENITY_PERSON_SPECIFIC);
                 
      BEGIN
         SELECT 
                DISC_VALUE
            INTO 
                B_DISCOUNT_AMOUNT FROM admin.GUEST_DISCOUNT WHERE GUEST_ID = guest__id;
                
                 EXCEPTION
                      WHEN NO_DATA_FOUND THEN
                            B_DISCOUNT_AMOUNT := 0;
         END;
         
           DBMS_OUTPUT.PUT_LINE('Guest Discount is: ' || B_DISCOUNT_AMOUNT || '%');
           
    BEGIN
         SELECT 
                RACK_AMOUNT
            INTO 
                B_TODAY_RATE FROM admin.HOTEL_RATES WHERE HOTEL_ID = h_id AND ANNUAL_RATE_DATE = TO_DATE(b_start_date);
                
                 EXCEPTION
                      WHEN NO_DATA_FOUND THEN
                            B_TODAY_RATE := 5000;
         END;
         
           DBMS_OUTPUT.PUT_LINE('Today rack amount is: ' || B_TODAY_RATE);
           
           -- calculate total amenity amount
           IF B_IS_AMENITY_PERSON_SPECIFIC = 'y' THEN
                B_TOTAL_AMENITY_AMOUNT := no_of_guests * B_AMENITY_AMOUNT;
                ELSE
                    B_TOTAL_AMENITY_AMOUNT := B_AMENITY_AMOUNT;
                END IF;
                
           dbms_output.put_line('Total Amenity Amount is : ' || B_TOTAL_AMENITY_AMOUNT);
           B_TOTAL_WITHOUT_DISCOUNT_AMOUNT := (B_TOTAL_AMENITY_AMOUNT + (B_ROOM_AMOUNT *  no_of_guests) + B_TODAY_RATE) * B_NO_DAYS;
           
           dbms_output.put_line('Booking rate per day without discount : ' || B_TOTAL_WITHOUT_DISCOUNT_AMOUNT);

           B_TOTAL_WITHOUT_DISCOUNT_AMOUNT := B_TOTAL_WITHOUT_DISCOUNT_AMOUNT * B_NO_DAYS;

           dbms_output.put_line('Total Booking rate without discount : ' || B_TOTAL_WITHOUT_DISCOUNT_AMOUNT);
           
           B_TOTAL_AMOUNT := B_TOTAL_WITHOUT_DISCOUNT_AMOUNT - ((B_DISCOUNT_AMOUNT / 100) * B_TOTAL_WITHOUT_DISCOUNT_AMOUNT);
           dbms_output.put_line('Total Booking rate after discount : ' || B_TOTAL_AMOUNT);
           
            dbms_output.put_line('----------------------------------------------------------');
            
            RETURN B_TOTAL_AMOUNT;
        END;
/
    -- IS_MAIN CHAR(1) NOT NULL,
    -- TABLEC REATION PROCEDURE
    create or replace procedure room_booking_creation is 
        table_name varchar2(4000);
   
    BEGIN
    -- table creation query
       table_name:='create table ROOM_BOOKING(
                        RESRV_ID NUMBER GENERATED BY DEFAULT AS IDENTITY,
                        BKNG_ID NUMBER NOT NULL,
                        GUEST_ID NUMBER NOT NULL,
                        NO_OF_GUEST NUMBER NOT NULL,
                        ROOM_TYP_ID NUMBER NOT NULL,
                        AMOUNT NUMBER NOT NULL,
                        AMENITY_ID NUMBER NOT NULL,
                        BKNG_TYP_ID NUMBER NOT NULL,
                        HOTEL_ID NUMBER NOT NULL,
                        NO_OF_ROOM NUMBER NOT NULL,
                        BKNG_START_DATE DATE NOT NULL,
                        BKNG_END_DATE DATE NOT NULL,
                        CONSTRAINT PK_RESRV_ID PRIMARY KEY(RESRV_ID),
                        CONSTRAINT FK_B_GUEST_ID FOREIGN KEY(GUEST_ID) REFERENCES GUEST(GUEST_ID),
                        CONSTRAINT FK_B_HOTEL_ID FOREIGN KEY(HOTEL_ID) REFERENCES HOTEL(HOTEL_ID)
                    )';
                    
       EXECUTE IMMEDIATE table_name;
    end room_booking_creation;
    /
    
   DECLARE
            tname varchar2(50);
            nCount NUMBER;
        BEGIN
            tname:='ROOM_BOOKING';
            SELECT count(*) into nCount FROM user_tables where table_name = tname;
            IF(nCount > 0)
            
            THEN
                DBMS_OUTPUT.PUT_LINE('TABLE '||tname || ' ALREADY EXISTS.');
            ELSE
            -- call to table creation stored procedure 
                begin 
                 room_booking_creation;
                end;    
            DBMS_OUTPUT.PUT_LINE('TABLE ' || tname ||' CREATED.');
            
            END IF;
            exception 
              when no_data_found then
               dbms_output.put_line('Table '||tname ||' doesnt exits! So we created one');
               
               -- call to table creation stored procedure 
               begin 
                 room_booking_creation;
                end; 
                
                when others
                    then
                    dbms_output.put_line('Something went wrong!');
                    dbms_output.put_line(dbms_utility.format_error_stack);
    END;
    /  
    --drop procedure insrt_room_booking;
    create or replace procedure insrt_room_booking(
            BKNG_ID IN NUMBER, 
            GUEST_ID IN NUMBER, 
            NO_OF_GUEST IN NUMBER, 
            ROOM_TYP_ID IN NUMBER,
            AMENITY_ID IN NUMBER,
            BKNG_TYP_ID IN NUMBER,
            HOTEL_ID IN NUMBER,
            NO_OF_ROOM IN NUMBER,
            --IS_MAIN IN CHAR,
            BKNG_START_DATE IN DATE,
            BKNG_END_DATE IN DATE
    )
    
    as B_TOTAL_AMOUNT NUMBER := 0;
    
    begin
                dbms_output.put_line('----------------------------------------------------------');
    BEGIN
    
        B_TOTAL_AMOUNT := GET_BOOKING_AMOUNT(
            ROOM_TYP_ID,
            NO_OF_ROOM,
            NO_OF_GUEST,
            AMENITY_ID,
            GUEST_ID,
            HOTEL_ID,
            BKNG_START_DATE,
            BKNG_END_DATE
        );
        exception
                     WHEN OTHERS THEN
                     B_TOTAL_AMOUNT := 0;
        end;

    --dbms_output.put_line('-- before insert -- ');
     insert into ROOM_BOOKING(
        BKNG_ID, 
        GUEST_ID, 
        NO_OF_GUEST, 
        ROOM_TYP_ID, 
        AMOUNT, 
        AMENITY_ID,
        BKNG_TYP_ID, 
        HOTEL_ID, 
        NO_OF_ROOM,
        BKNG_START_DATE, 
        BKNG_END_DATE
    ) values (
        BKNG_ID,
        GUEST_ID, 
        NO_OF_GUEST,
        ROOM_TYP_ID, 
        B_TOTAL_AMOUNT, 
        AMENITY_ID, 
        BKNG_TYP_ID, 
        HOTEL_ID, 
        NO_OF_ROOM,
        BKNG_START_DATE, 
        BKNG_END_DATE);

             dbms_output.put_line('Row inserted at ROOM BOOKING table');
             dbms_output.put_line('----------------------------------------------------------');
            commit;
            exception
            WHEN DUP_VAL_ON_INDEX
                then
                dbms_output.put_line('Oops! This record already exists');
                ROLLBACK;
                when others then
                     dbms_output.put_line('ERROR! While inserting data in room booking');

                     dbms_output.put_line('Error for  => BKNG_ID ' || BKNG_ID || ', GUEST_ID ' || GUEST_ID);
                    rollback;
                    dbms_output.put_line('The error encountered is: ');
                    dbms_output.put_line(dbms_utility.format_error_stack);
                    dbms_output.put_line('----------------------------------------------------------');
            end insrt_room_booking;
/

EXECUTE insrt_room_booking(1,1,2,1,18,2,1,2,TO_DATE('2019/10/10', 'YYYY-MM-DD'),TO_DATE('2019/10/12', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(2,2,2,4,18,2,1,2,TO_DATE('2021/04/26', 'YYYY-MM-DD'),TO_DATE('2021/05/01', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(3,3,2,1,1,2,2,2,TO_DATE('2021/03/29', 'YYYY-MM-DD'),TO_DATE('2021/04/05', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(4,4,2,4,2,2,2,2,TO_DATE('2021/02/18', 'YYYY-MM-DD'),TO_DATE('2021/02/23', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(5,3,3,3,13,1,1,2,TO_DATE('2021/04/28', 'YYYY-MM-DD'),TO_DATE('2021/05/03', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(6,4,3,2,15,1,1,2,TO_DATE('2021/01/05', 'YYYY-MM-DD'),TO_DATE('2021/01/09', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(7,6,3,4,22,1,1,2,TO_DATE('2021/03/23', 'YYYY-MM-DD'),TO_DATE('2021/03/29', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(8,1,3,3,11,1,2,2,TO_DATE('2021/01/07', 'YYYY-MM-DD'),TO_DATE('2021/01/09', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(9,4,3,2,20,1,2,2,TO_DATE('2021/04/26', 'YYYY-MM-DD'),TO_DATE('2021/05/03', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(10,2,3,4,5,1,2,2,TO_DATE('2021/03/28', 'YYYY-MM-DD'),TO_DATE('2021/04/02', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(11,2,4,3,20,3,1,2,TO_DATE('2021/01/01', 'YYYY-MM-DD'),TO_DATE('2021/01/04', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(12,6,4,2,20,3,1,2,TO_DATE('2021/01/06', 'YYYY-MM-DD'),TO_DATE('2021/01/12', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(13,4,4,1,20,3,1,2,TO_DATE('2021/02/12', 'YYYY-MM-DD'),TO_DATE('2021/02/15', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(14,5,4,4,20,3,1,2,TO_DATE('2021/03/25', 'YYYY-MM-DD'),TO_DATE('2021/03/29', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(15,1,4,3,8,3,2,2,TO_DATE('2021/04/27', 'YYYY-MM-DD'),TO_DATE('2021/05/03', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(16,3,4,2,9,3,2,2,TO_DATE('2021/01/05', 'YYYY-MM-DD'),TO_DATE('2021/01/11', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(17,4,4,1,15,3,2,2,TO_DATE('2021/02/12', 'YYYY-MM-DD'),TO_DATE('2021/02/15', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(18,6,4,4,16,3,2,2,TO_DATE('2021/03/24', 'YYYY-MM-DD'),TO_DATE('2021/03/27', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(19,1,1,1,14,2,1,2,TO_DATE('2021/02/14', 'YYYY-MM-DD'),TO_DATE('2021/02/19', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(20,4,1,1,19,2,2,2,TO_DATE('2021/04/28', 'YYYY-MM-DD'),TO_DATE('2021/05/03', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(21,5,5,3,14,1,1,2,TO_DATE('2021/01/10', 'YYYY-MM-DD'),TO_DATE('2021/01/15', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(22,3,5,2,14,1,1,2,TO_DATE('2021/03/22', 'YYYY-MM-DD'),TO_DATE('2021/03/25', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(23,6,5,1,15,1,1,2,TO_DATE('2021/04/28', 'YYYY-MM-DD'),TO_DATE('2021/05/03', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(24,1,5,4,12,1,1,1,TO_DATE('2021/02/16', 'YYYY-MM-DD'),TO_DATE('2021/02/21', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(25,2,5,3,22,1,1,2,TO_DATE('2021/03/30', 'YYYY-MM-DD'),TO_DATE('2021/04/04', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(26,1,5,3,9,1,2,2,TO_DATE('2021/02/20', 'YYYY-MM-DD'),TO_DATE('2021/02/27', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(27,3,5,2,13,1,2,1,TO_DATE('2021/03/25', 'YYYY-MM-DD'),TO_DATE('2021/03/29', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(28,6,5,1,15,1,2,2,TO_DATE('2021/01/06', 'YYYY-MM-DD'),TO_DATE('2021/01/10', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(29,4,5,4,18,1,2,2,TO_DATE('2021/04/28', 'YYYY-MM-DD'),TO_DATE('2021/05/03', 'YYYY-MM-DD'));
EXECUTE insrt_room_booking(30,5,5,3,22,1,2,2,TO_DATE('2021/03/22', 'YYYY-MM-DD'),TO_DATE('2021/03/29', 'YYYY-MM-DD'));
--EXECUTE insrt_room_booking(1,2,2,4,5,2,2,2,TO_DATE('2021/04/28', 'YYYY-MM-DD'),TO_DATE('2021/05/03','YYYY-MM-DD'));
--EXECUTE insrt_room_booking(2,2,3,2,5,2,2,2,TO_DATE('2021/05/02', 'YYYY-MM-DD'),TO_DATE('2021/05/05','YYYY-MM-DD'));
--EXECUTE insrt_room_booking(3,1,3,2,5,2,1,1,TO_DATE('2021/04/25', 'YYYY-MM-DD'),TO_DATE('2021/04/30','YYYY-MM-DD'));
--EXECUTE insrt_room_booking(4,1,3,2,5,2,2,1,TO_DATE('2021/04/26', 'YYYY-MM-DD'),TO_DATE('2021/04/30','YYYY-MM-DD'));

---------------------------------------------------- Room Checkin -------------------------------------------
create or replace procedure checkin_creation is
    table_name varchar2(4000);
   
    BEGIN
    -- table creation query
       table_name:='CREATE TABLE CHECK_IN(
                            CKIN_ID  NUMBER GENERATED BY DEFAULT AS IDENTITY,
                            CHECKIN_DT_TIME TIMESTAMP NOT NULL,
                            CKOUT_DT_TIME TIMESTAMP NOT NULL,
                            RESRV_ID NUMBER NOT NULL,
                            ROOM_ID NUMBER NOT NULL,
                            STAFF_ID NUMBER NOT NULL,
                            constraint pk_ckin_id PRIMARY KEY(CKIN_ID),
                            constraint fk_rm_id FOREIGN KEY(ROOM_ID) REFERENCES room (room_id),
                            constraint fk_st_id FOREIGN KEY(STAFF_ID) REFERENCES staff (staff_id),
                            constraint fk_rsv_id FOREIGN KEY(RESRV_ID) REFERENCES room_booking (resrv_id)
                    )';
       EXECUTE IMMEDIATE table_name;
    end checkin_creation;
    /
    
      DECLARE
            table_name varchar2(50);
            nCount NUMBER;
        BEGIN
            table_name:='CHECK_IN';
            SELECT count(*) into nCount FROM user_tables where table_name = 'CHECK_IN';
            IF(nCount > 0)
            
            THEN
                    DBMS_OUTPUT.PUT_LINE('TABLE '|| table_name||' ALREADY EXISTS.');
            ELSE
            -- call to table creation stored procedure 
                begin 
                 checkin_creation;
                end;    
             DBMS_OUTPUT.PUT_LINE('TABLE '||table_name||' CREATED.');
            
            END IF;
            exception 
              when no_data_found then
               dbms_output.put_line('table doesnt exits!, So we created one');
               
               -- call to table creation stored procedure 
               begin 
                 checkin_creation;
                end; 
                
                when others
                    then
                    dbms_output.put_line('Something went wrong!');
                    dbms_output.put_line(dbms_utility.format_error_stack);
    END;
    /  
    
     create or replace procedure insrt_checkin(chkin_timestamp in timestamp,chkout_timestamp in timestamp,resrv_id in number,room_id in number,staff_id in number)
         as
          begin
                 dbms_output.put_line('----------------------------------------------------------');
                insert into CHECK_IN(CHECKIN_DT_TIME,CKOUT_DT_TIME,RESRV_ID,ROOM_ID,STAFF_ID) values (chkin_timestamp,chkout_timestamp,resrv_id,room_id,staff_id);
             dbms_output.put_line('Row inserted at CHECK_IN table');
                 dbms_output.put_line('----------------------------------------------------------');
            commit;
            exception
                WHEN DUP_VAL_ON_INDEX
                then
                dbms_output.put_line('Oop! This record already exists');
                rollback;
                when others then
                    dbms_output.put_line('Error while inserting data in CHECK_IN Table');
                    rollback;
                    dbms_output.put_line('The error encountered is: ');
                    dbms_output.put_line(dbms_utility.format_error_stack);
                    dbms_output.put_line('----------------------------------------------------------');
            end insrt_checkin;
     /

    execute insrt_checkin(TO_DATE('2021/02/12 08:59:59', 'yyyy/mm/dd hh24:mi:ss'),TO_DATE('2021/02/15 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),13,1,18);

    --execute insrt_checkin(TO_DATE('2021/04/28 08:59:59', 'yyyy/mm/dd hh24:mi:ss'),TO_DATE('2021/05/03 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),1,8,18);
    
    --execute insrt_checkin(TO_DATE('2021/03/29 08:59:59', 'yyyy/mm/dd hh24:mi:ss'),TO_DATE('2021/04/05 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),21,1,18);
    
    --execute insrt_checkin(TO_DATE('2021/03/29 08:59:59', 'yyyy/mm/dd hh24:mi:ss'),TO_DATE('2021/04/05 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),21,2,18);
    
    --execute insrt_checkin(TO_DATE('2021/04/26 08:59:59', 'yyyy/mm/dd hh24:mi:ss'),TO_DATE('2021/05/01 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),24,7,20);
    
    --execute insrt_checkin(TO_DATE('2021/04/26 08:59:59', 'yyyy/mm/dd hh24:mi:ss'),TO_DATE('2021/05/01 23:59:59', 'yyyy/mm/dd hh24:mi:ss'),27,6,19);

-- update queries

create or replace 
    procedure  update_email(new_email in varchar2, id1 in varchar2)
      as
        begin
            dbms_output.put_line('Updating Email');
                update guest 
                set  email= new_email  where guest_id = id1;
            commit;
        dbms_output.put_line('Update Complete');
    end;
/

create or replace 
    procedure delete_location
    as
        begin
             dbms_output.put_line('Deleting Location');
        delete from Location
            where location_id not in (select location_id from hotel);
        commit;
    dbms_output.put_line('Delete Complete');
    end;
/

CREATE OR REPLACE PROCEDURE print_guest(
        in_guest_id NUMBER 
    )
        IS
          r_guest guest%ROWTYPE;
          mem_name varchar2(16) := 'NA';
          member_id NUMBER;
        BEGIN
              -- get contact based on customer id
              SELECT * INTO r_guest FROM guest WHERE guest_id = in_guest_id;
              
              member_id := r_guest.mem_id;
              
              --dbms_output.put_line('member_id ' || member_id);
              
              IF member_id IS NOT NULL THEN
               -- dbms_output.put_line('in member');
                select mem_type into mem_name from member where mem_id = member_id;
              END IF;
            
              -- print out guest's information
              dbms_output.put_line( r_guest.guest_name || ' Membership => ' ||
              mem_name || ' EMAIL => <' || r_guest.email ||'> ' );
        
        EXCEPTION
           WHEN OTHERS THEN
              dbms_output.put_line( SQLERRM );
    END;
/

-------------------------------------------------VIEWS----------------------------------------------------------
-------------------------------------------------hotel_sister property----------------------
create or replace view sister_property
as
select a.location_id,a.city,a.state,a.zipcode,b.location_id as sister_loc_id, b.city as sister_city,b.state as sister_state from location a
inner join location b
on a. zipcode = b. zipcode
where a.zipcode = b. zipcode and a.city<>b.city;

select * from sister_property;
----------------------------------------------------View for front_desk-----------------------

create or replace view guest_frontdesk
as
select guest_id, guest_name, dob,ph_num,email, vip_status,gender, preferences
from guest a
join preferences b
on a.prf_id = b. prf_id;

---------------------------------------

create or replace view  uncleaned_rooms
as
select Room_id, Room_typ_desc ,Room_lvl,Room_Avl_sts, 'Not Cleaned' room_sts
from 
room a
join room_type b
on a.room_typ_id = b. room_typ_id
where hotel_id =1 and room_sts_id = 2;

--------------------------------------------------- ROLES --------------------------------------------------------------------------------

---------------------------------------------------FrontDesk-----------------------------

drop user frontdesk;
create user frontdesk identified by Database1234#;
grant connect to frontdesk;
grant create session to frontdesk;
grant unlimited tablespace to frontdesk;
grant select,insert,update on ADMIN.guest to frontdesk;
grant select,insert,update on ADMIN.room_booking to frontdesk;
grant select,insert,update on ADMIN.preferences to frontdesk;
grant select,insert,update on ADMIN.room to frontdesk;
grant select on ADMIN.room_type to frontdesk;
grant select on ADMIN.amenity to frontdesk;
grant execute on get_booking_amount to frontdesk;
grant execute on insrt_room_booking to frontdesk;
GRANT SELECT ON guest_discount to frontdesk; 
GRANT SELECT ON hotel_rates to frontdesk; 

----------------------------------------------------HouseKeeping----------------------------
drop user housekeeping;
create user housekeeping identified by Database1234#;
grant connect,resource to housekeeping;
grant create session to housekeeping;
grant unlimited tablespace to housekeeping;
grant select,insert on admin.house_keeping to housekeeping;
grant select,insert on admin.room_status to housekeeping;
grant select,insert on admin.room to housekeeping;
grant execute on insrt_house_keeping to housekeeping;

------------------------------------------------------Manager--------------------------------
drop user manager;
create user manager identified by Database1234#;
grant connect,resource to manager;
grant create session to manager;
grant unlimited tablespace to manager;
grant select,insert,update on admin.guest to manager;
grant select,insert,update on admin.annual_rate to manager;
grant select,insert,update on admin.staff to manager;
grant select,insert,update on admin.member to manager;
grant select,insert,update on admin.preferences to manager;
grant select,insert,update on admin.check_in to manager;
grant select,insert,update on admin.discount to manager;
grant select,insert,update on admin.department to manager;
grant select on admin.designation to manager;
grant select,insert,update on admin.amenity to manager;

--dbms_output.put_line(' ---------------------------------------------------- ENDING WITH SQL QUERIES ----------------------------------------------------');
select localtimestamp from dual;


